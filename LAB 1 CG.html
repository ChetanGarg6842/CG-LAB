<!DOCTYPE html>
<!--
	----------------------------------------------------------------------------------------------------------------------------------------------------- 
	Version	| Date 			| Author							| Description
	-----------------------------------------------------------------------------------------------------------------------------------------------------
	001		| 18 Jan 2022	| Bhupendra Singh, UPES Dehradun	| WebGL is wrapped inside the draw() method. The method can be used to display 2D points.
			|				|									| A part of Computer Graphics Lab work.
	-----------------------------------------------------------------------------------------------------------------------------------------------------
-->
<html>
	<head>
		<title>CG Lab - "Type your sap id here".</title>
	</head>
	<body>
		<canvas id="canvas"  width="1200" height="600">
			Your browser does not support HTML5
		</canvas>
		<br/>
		<script>
		//////////////////////////////// YOUR CODE SHOULD START AFTER THIS LINE //////////////////////
			var SCREEN_SIZE = 200;		// The size of the coordinate axis, X, Y = [0 SCREEN_SIZE]
			var verticesData = [10,180,  10,179, 10,178, 10,177, 10,176, 10,175, 10,174, 10,173, 10,172, 10,171, 10,170 ,  10,169,  11,181, 11,168 , 12,182, 12,167, 13,166, 14,166, 15,167,  13,183, 14,183, 15,182,

19,182,  19,181,  19,180,  19,179,  19,178,  19,177,  19,176,  19,175, 19,174,  19,173,  19,172, 19,171,  19,170,  19,169,  19,168,  19,167,  20,175,  21,175,  21,175,  22,175,  23,175,  24,175,  25,175,  25,176,  25,177,  25,178,  25,179,  25,180, 25,181,  25,182,  25,174,  25,173,  25,172,  25,171,  25,170,  25,169,  25,168,  25,167, 


28,182,  28,181,  28,180,  28,179,  28,178,  28,177,  28,176,  28,175,  28,174,  28,173,  28,172,  28,171,  28,170,  28,169,  28,167,  29,167,  30,167,  31,167,  32,167,  33,167,  29,175,  30,175,  31,175,  32,175,  33,175,  29,182,  30,182,  31,182,  32,182,  33,182,


36,182,  37,182,  38,182,  39,182,  40,182,  41,182,  42,182,  43,182,  44,182,  40,181,  40,179,  40,178,  40,177,  40,176,  40,175,  40,174,  40,173,  40,172,  40,171,  40,170,  40,169,  40,168,  40,167,  48,167,  49,168,  49,169,  50,170,  50,171,  51,171, 51,172,  51,173,  51,174,  52,173,  52,174,  53,175,  53,176,  53,177,  53,178,  53,179,  54,179,  54,180,  54,181, 55,182,  62,167,  61,168,  61,169,  60,170,  60,171,  59,171, 59,172,  59,173,  59,174,  58,173,  58,174,  57,175,  57,176,  57,177,  57,178,  57,179,  56,179,  56,180,  56,181, 55,182, 55,173,  54,173,  53,173,  52,173,  56,173,  57,173,  58,173,  


65,182,  65,181,  65,180,  65,179,  65,178,  65,177,  65,176,  65,175, 65,174,  65,173,  65,172, 65,171,  65,170,  65,169,  65,168,  65,167,  71,182,  71,181,  71,180,  71,179,  71,178,  71,177,  71,176,  71,175, 71,174,  71,173,  71,172, 71,171,  71,170,  71,169,  71,168,  71,167,  66,180,  66,179,  67,178,  68,177,  69,176,  70,175, 71,174,


 83,180,  83,179, 83,178, 83,177, 83,176, 83,175, 83,174, 83,173, 83,172, 83,171, 83,170 ,  83,169,  87,181, 87,168 , 85,182, 85,167, 85,166, 84,166, 83,167,  86,183, 85,183, 86,182,  83,181,  84,182,  83,182,  83,167, 84,167, 86,167,  87,168,  87,169, 87,170,  87,171,  87,172,   88,172,  89,172,  89,172,  89,171,  89,170,  89,169,  89,168,  89,167,

94,182,  94,181,  94,180,  94,179,  94,178,  94,177,  94,176,  94,175, 94,174,  94,173,  94,172, 94,171,  94,170,  94,169,  94,168,  94,167,  95,182,  96,182,  97,182,  98,182,  99,182,  99,182,  100,182,  95,182,  96,176,  97,176,  98,176,  99,176,  99,176,  100,176,  100,176,  100,177,  100,178,  100,179,  100,180, 100,181,  100,182,  100,174,  100,173,  100,172,  100,171,  100,170,  100,169,  100,168,  100,167, 

113,180,  113,179, 113,178, 113,177, 113,176, 113,175, 113,174, 113,173, 113,172, 113,171, 113,170 ,  113,169,  117,181, 117,168 , 115,182, 115,167, 115,166, 114,166, 113,167,  116,183, 115,183, 116,182,  113,181,  114,182,  113,182,  113,167, 114,167, 116,167,  117,168,  117,169, 117,170,  117,171,  117,172,   118,172,  119,172,  119,172,  119,171,  119,170,  119,169, 119,168,  119,167,

103,182,  103,181,  103,180,  103,179,  103,178,  103,177,  103,176,  103,175, 103,174,  103,173,  103,172, 103,171,  103,170,  103,169,  103,168,  103,167,20,175,  21,175,  21,175,  22,175,  23,175,  24,175,  25,175,  25,176,  25,177,  25,178,  25,179,  25,180, 25,181,  25,182,  25,174,  25,173,  25,172,  25,171,  25,170,  25,169,  25,168,  25,167
];		
// The array holds the x,y of all the data points to be drawn on the screen.
		

			draw(verticesData);			// This method draws all the points provided in the argument array.
		//////////////////////////////// YOUR CODE SHOULD END BEFORE THIS LINE //////////////////////

			function XY_mapping(){
				let inputVertices = arguments[0];			
				var SCREEN_SIZE = arguments[1];
				for(var i = 0; i < inputVertices.length; i++)
				{
					inputVertices[i] = -1 + inputVertices[i]/(SCREEN_SIZE/2);
					inputVertices[i] = inputVertices[i].toFixed(2);
				}
				return inputVertices;
			}

			//////////////////////////////// WebGL code starts from here. Don't touch uncless you have understanding of it.//////////////////////
			function draw () {		
				var verticesData = arguments[0];	
				verticesDataArrayJS = XY_mapping(verticesData, SCREEN_SIZE);	

				var gl, shaderProgram;

				gl = initializeWebGL(gl);

				//Step 1 (Set background color): First specify the color with the help of Quadlet(R,G,B,Alpha) and the clear the buffer related to background.
				gl.clearColor(0, 0, 0, 1.0);	
				gl.clear(gl.COLOR_BUFFER_BIT);
				//Note: The default background color in WebGl is white.

				//Step 4 (Create GPU meomry buffer): In the GPU for holding vertices data of type ARRAY_BUFFER.
				var rectVBO = gl.createBuffer();
				gl.bindBuffer(gl.ARRAY_BUFFER, rectVBO);

				//Step 5 (Pass the vertices data to the buffer created previously).
				gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(verticesDataArrayJS), gl.STATIC_DRAW);

				//Seven Steps Shader side coding in JS to get the shader program.
				shaderProgram = getShaderProgram(gl);

				//Step 14 (Use the shader program):
				gl.useProgram(shaderProgram);

				//Step 15 (Get access to GPU's geometry coordinates): Get the pointer to the geometry coordinates defined in vertex shader through the shader program.
				var coordinatesInfoPoniter = gl.getAttribLocation(shaderProgram, 'geometryCoordinatesGPU');
				
				//Step 16 (Enable Vertex Attribute Array): It enables the pointer defined in Step 8 to access the vertex buffered data.
				gl.enableVertexAttribArray(coordinatesInfoPoniter);

				//Step 17 (Buffer data definition): Define how the data on the GPU buffer is arranged. SO that the pointer defined in Step 8 can access the data from the buffer.
				gl.vertexAttribPointer(
					coordinatesInfoPoniter, // Vertices pointer
					2, 						// Number of elements per attribute
					gl.FLOAT, 				// Type of elements
					gl.FALSE,				// Data Normalization
					2 * Float32Array.BYTES_PER_ELEMENT, // Size of an individual vertex
					0 						// Offset from the beginning of a single vertex to this attribute
				);
				
				//Step 18 (Draw the geometry): Issue the draw command to generate the geometry as defined by the indices and the type of primitive to create.
				gl.drawArrays(gl.POINTS, 0, verticesDataArrayJS.length);
			};

			function initializeWebGL(gl)
			{
				var canvas = document.getElementById('canvas');

				canvas.width = window.innerWidth;;
				canvas.height = window.innerHeight;;

				gl = canvas.getContext('webgl');

				if (!gl) {
					console.log('WebGL not supported, falling back on experimental-webgl');
					gl = canvas.getContext('experimental-webgl');
				}

				if (!gl) {
					alert('Your browser does not support WebGL');
					return;
				}
				return gl;
			}

			//Seven steps of Shader side coding
			function getShaderProgram(gl)
			{
				//Step 7 (Define vertex shader text): Define the code of the vertex shader in the form of JS text.
				var vertexShaderText = 
				' attribute vec2 geometryCoordinatesGPU; ' +
				' void main() ' +
				' { ' +
				'		gl_Position = vec4(geometryCoordinatesGPU, 1.0, 1.0); ' +
				'		gl_PointSize = 10.0;	'+
				' } ';

				//Step 8 (Create actual vertex shader): Create the actual vertex shader with the text defined in Step 1.
				var vertexShader = gl.createShader(gl.VERTEX_SHADER);
				gl.shaderSource(vertexShader, vertexShaderText);

				//Step 9 (Compile vertex shader):
				gl.compileShader(vertexShader);
				if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {
					console.error('ERROR compiling vertex shader!', gl.getShaderInfoLog(vertexShader));
					return;
				}

				//Step 10: Repeat the above 3 steps for fragment shader.
				var fragmentShaderText =
				' void main() ' +
				' { ' +
				'  		gl_FragColor = vec4(1, 1, 1, 1); ' +	
				' } ';

				var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
				gl.shaderSource(fragmentShader, fragmentShaderText);

				gl.compileShader(fragmentShader);
				if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {
					console.error('ERROR compiling fragment shader!', gl.getShaderInfoLog(fragmentShader));
					return;
				}

				//Step 11 (Shader program): With the compiled vertex and fragment shader, create the shader program.
				var shaderProgram = gl.createProgram();
				gl.attachShader(shaderProgram, vertexShader);
				gl.attachShader(shaderProgram, fragmentShader);

				//Step 12 (Link shader program): 
				gl.linkProgram(shaderProgram);
				if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
					console.error('ERROR linking program!', gl.getProgramInfoLog(shaderProgram));
					return;
				}

				//Step 13 (Validate Shader program): Checks if the shader program has been succesfully linked and can be used further.
				gl.validateProgram(shaderProgram);
				if (!gl.getProgramParameter(shaderProgram, gl.VALIDATE_STATUS)) {
					console.error('ERROR validating program!', gl.getProgramInfoLog(shaderProgram));
					return;
				}
				return shaderProgram;
			}
		</script>
	</body>
</html>